{% extends "chat/base.html" %}
{% load account pagination %}

{% block chat_content %}

<h1 class="font-semibold text-xl mb-3">#{{ room.name }}</h1>
{% paginate chat_messages page_size=8 as page_obj %}
{% include "_pagination.html" %}
<div>


  {% if page_obj.number == 1 %}
  <div data-controller="socket"
       data-socket-url-value="/ws/chat/{{ room.id }}/"
       data-socket-fragment-value="room-{{ room.id }}">
    {% else %}
    <div>
      {% endif %}
      {% include "chat/_messages.html" with chat_messages=page_obj.object_list %}
    </div>

    {% if is_member and page_obj.number == 1 %}
    <form class="flex items-center mb-3"
          data-controller="socket"
          data-socket-url-value="/ws/chat/{{ room.id }}/"
          data-action="socket#send">
      {% csrf_token %}
      <input type="text"
             name="text"
             placeholder="Write your message..."
             required
             data-socket-target="input"
             class="mr-3 w-full">
      <button class="rounded bg-blue-800 hover:bg-blue-600 px-3 py-2 text-white">Send</button>
    </form>
    {% endif %}
  </div>
  {% endblock chat_content %}
